<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>MUSEOS</title>
        <link rel="stylesheet" href="./styles.css" />
        <link rel="stylesheet" href="../../assets/fonts/stylesheet.css" />
        <link rel="stylesheet" href="../../assets/css/reset.css" />
    </head>
    <body>
        <main style="height: 1050px">
            <header class="header">
                <div class="content">
                    <div class="navbar">
                        <div class="logo">
                            <img src="../../assets/img/logo.svg" alt="" />
                            <img src="../../assets/img/museos.svg" alt="" />
                        </div>
                        <ul>
                            <li>
                                <a href="#!">
                                    <div class="noti-wrapper">
                                        <img
                                            src="../../assets/img/noti.svg"
                                            alt=""
                                        />
                                        <div class="noti-num">1</div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="../../index.html">home</a>
                            </li>
                            <li>
                                <a href="#!">library</a>
                            </li>
                            <li>
                                <a href="#!">upload</a>
                            </li>
                            <li>
                                <a href="#!">settings</a>
                            </li>
                            <li>
                                <input
                                    type="text"
                                    class="search-input"
                                    placeholder="songs, genres, artists and more..."
                                />
                            </li>
                        </ul>

                        <div class="action">
                            <a href="../Sign In/signin.html" class="action-link"
                                >login</a
                            >
                            <a href="../Sign Up/signup.html" class="action-link"
                                >sign up</a
                            >
                        </div>
                    </div>
                </div>
            </header>
            <div class="song-wrapper">
                <div class="song-cta">
                    <img
                        src="../../assets/img/thumbnail-1.jpg"
                        alt=""
                        class="song-img"
                    />
                    <div class="song-name line-clamp">fwefwef</div>
                    <div class="cta-wrapper">
                        <div class="song-artist">
                            <div class="artist-name">HIEUTHUHAI, marzuz</div>
                        </div>
                        <div class="icon-cta">
                            <div class="icons">
                                <div class="img-heart">
                                    <a href="#"
                                        ><img
                                            src="../../assets/img/heart.svg"
                                            alt=""
                                    /></a>
                                </div>
                                <div class="img-down">
                                    <a href="#"
                                        ><img
                                            src="../../assets/img/download.svg"
                                            alt=""
                                    /></a>
                                </div>
                                <div class="img-dot">
                                    <a href="#"
                                        ><img
                                            src="../../assets/img/dot.svg"
                                            alt=""
                                    /></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="track-time">
                        <input
                            type="range"
                            min="1"
                            max="100"
                            value="0"
                            class="seek_slider"
                            onchange="seekTo()"
                        />
                        <div class="time">
                            <div class="total-time">03:20</div>
                            <div class="last-time">00:12</div>
                        </div>
                    </div>
                    <div class="action-wrapper">
                        <div class="song-action">
                            <div class="random-song">
                                <a href="">
                                    <img
                                        src="../../assets/img/random-ic.svg"
                                        alt=""
                                        class="random-ic"
                                    />
                                </a>
                            </div>
                            <div class="song-center">
                                <div class="back-song" onclick="prevTrack()">
                                    <img
                                        src="../../assets/img/back-ic.svg"
                                        alt=""
                                        class="back-ic"
                                    />
                                </div>
                                <div
                                    class="play-song playpause-track"
                                    onclick="playpauseTrack()"
                                >
                                    <img
                                        src="../../assets/img/play-circle.svg"
                                        class="play-ic"
                                        style="width: 60.68px; height: 60.929px"
                                    />
                                </div>
                                <div class="next-song" onclick="nextTrack()">
                                    <img
                                        src="../../assets/img/next-ic.svg"
                                        alt=""
                                        class="next-ic"
                                    />
                                </div>
                            </div>
                            <div class="loop-song">
                                <a href="">
                                    <img
                                        src="../../assets/img/loop-ic.svg"
                                        alt=""
                                        class="loop-ic"
                                    />
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="song-desc">
                    <div class="lyric-wrapper">
                        <div class="lyric-title">Lyrics</div>
                        <div class="lyric">
                            <p>
                                (Hey, Kewtiie) <br /><br />

                                Anh không nhớ nổi lần cuối cùng anh nhìn vào mắt
                                em đó là từ bao giờ
                            </p>
                            <p>
                                Em từng trách anh chỉ ôm ước mơ, còn không sợ
                                mất em thì làm sao chờ?
                            </p>
                            <p class="singing-lyric">
                                Lúc đó anh có xin lỗi hay không thì kết quả nó
                                cũng như nhau mà
                            </p>
                            <p class="sang-lyric">
                                Cuối cùng thì hai ta đều ích kỷ, nông nổi, tự
                                trong cao mà
                            </p>
                            <p class="sang-lyric">
                                Ta từng bắt gặp nhau ở khắp Sài Gòn, chắc là lúc
                                còn yêu thì muốn tránh cũng khó
                            </p>
                            <p class="sang-lyric">
                                Không thể tin là mình chưa từng gặp lại sau khi
                                mà anh bước qua cánh cửa đó
                            </p>
                        </div>
                    </div>
                    <div class="info-wrapper">
                        <div class="song-info">
                            <div class="follow-cta">
                                <img
                                    src="../../assets/img/thumbnail-1.jpg"
                                    alt=""
                                    class="song-img"
                                    style="
                                        width: 120px;
                                        height: 120px;
                                        border-radius: 20px;
                                    "
                                />
                                <a href="#" class="follow">follow</a>
                            </div>
                            <div class="info">
                                <div class="artist-title">HIEUTHUHAI</div>
                                <div class="followers">735,229 followers</div>
                                <div class="listeners">
                                    962,316 monthly listeners
                                </div>
                                <a href="#" class="fb-link"
                                    ><img
                                        src="../../assets/img/fb-icon.svg"
                                        alt=""
                                        class="fb-ic"
                                    /><span>facebook</span></a
                                >
                                <a href="#" class="ig-link"
                                    ><img
                                        src="../../assets/img/ig-icon.svg"
                                        alt=""
                                        class="ig-ic"
                                    /><span>instagram</span></a
                                >
                            </div>
                        </div>
                        <div class="next-song">
                            <div class="sub-title">
                                <span>next song</span>
                                <a href="#" class="playlist-cta"
                                    >view playlist</a
                                >
                            </div>
                            <div class="next-info">
                                <img
                                    src="../../assets/img/thumbnail-2.jpg"
                                    alt=""
                                    class="next-img"
                                    style="
                                        width: 80px;
                                        height: 80px;
                                        border-radius: 20px;
                                    "
                                />
                                <div class="next-song-info">
                                    <div class="next-title line-clamp">
                                        no love no life
                                    </div>
                                    <div class="artist-title">
                                        HIEUTHUHAI, marzuz
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer">
                <div class="content">
                    <div class="left-footer">
                        <div class="logo">
                            <img
                                src="../../assets/img/footer-icon.svg"
                                alt=""
                            />
                            <div class="logo-text">museos</div>
                        </div>
                        <div class="copyright">
                            Copyright © 2023 Faculty of Information Technology
                            VNU-HCMUS. All rights reserved.
                        </div>
                    </div>
                    <div class="right-footer">
                        <a href="#!" class="terms-condition"
                            >terms and conditions</a
                        >
                        <a href="#!" class="faq">FAQ</a>
                        <a href="#!" class="contacts">contacts</a>
                    </div>
                </div>
            </footer>
        </main>
    </body>
    <script>
        let updateTimer;
        let curr_time = document.querySelector(".total-time");
        let total_duration = document.querySelector(".last-time");
        let seek_slider = document.querySelector(".seek_slider");
        let artist_name = document.querySelector(".artist-name");
        let song_name = document.querySelector(".song-name");
        let playpause_btn = document.querySelector(".playpause-track");
        let curr_track = document.createElement("audio");
        let cover_img = document.querySelector(".song-img");
        let isPlaying = false;
        let temp_song;
        let track_list;
        let track_index = 0;
        let next_btn = document.querySelector(".next-song");
        let prev_btn = document.querySelector(".back-song");
        function getSongById(songId) {
            var xhr = new XMLHttpRequest();
            var url = " http://localhost:3000/api/v1/songs/" + songId;
            xhr.open("GET", url, true);
            xhr.onload = function () {
                if (xhr.status === 200) {
                    // Success: handle the response
                    var response = JSON.parse(xhr.responseText);
                    temp_song = response;
                    console.log("Song:", response);

                    // You can access the comment-total-count header using getResponseHeader
                    var commentCount = xhr.getResponseHeader(
                        "comment-total-count"
                    );
                    console.log("Comment Count:", commentCount);
                } else if (xhr.status === 500) {
                    // Error: handle the error response
                    var errorResponse = JSON.parse(xhr.responseText);
                    console.error("Error:", errorResponse.message);
                }
            };
            xhr.send();
        }
        function getAllSongs(callback) {
            var xhr = new XMLHttpRequest();
            var url = " http://localhost:3000/api/v1/songs/";
            xhr.open("GET", url, true);
            xhr.onload = function () {
                if (xhr.status === 200) {
                    // Success: handle the response
                    var response = JSON.parse(xhr.responseText);
                    track_list = Object.values(response);
                    // console.log("Song:", track_list);
                    callback(track_list);
                } else if (xhr.status === 500) {
                    // Error: handle the error response
                    var errorResponse = JSON.parse(xhr.responseText);
                    console.error("Error:", errorResponse.message);
                }
            };
            xhr.send();
        }
        function seekTo() {
            seekto = curr_track.duration * (seek_slider.value / 100);
            curr_track.currentTime = seekto;
        }
        function resetValues() {
            curr_time.textContent = "00:00";
            total_duration.textContent = "00:00";
            seek_slider.value = 0;
        }
        function loadTrack(track_index) {
            clearInterval(updateTimer);
            resetValues();
            console.log("Song:", track_list);
            console.log(track_list[0].filePath);
            trackSrc = track_list[track_index].filePath;
            var songNameWithoutExtension = track_list[
                track_index
            ].title.replace(/\.mp3$/, "");
            artist_name.textContent = track_list[track_index].artist.name;
            song_name.textContent = songNameWithoutExtension;
            cover_img.src = track_list[track_index].coverPath;
            curr_track.src = trackSrc;
            curr_track.load();
            updateTimer = setInterval(seekUpdate, 1000);
            curr_track.addEventListener("ended", nextTrack);
        }
        function seekUpdate() {
            let seekPosition = 0;

            // Check if the current track duration is a legible number
            if (!isNaN(curr_track.duration)) {
                seekPosition =
                    curr_track.currentTime * (100 / curr_track.duration);
                seek_slider.value = seekPosition;

                // Calculate the time left and the total duration
                let currentMinutes = Math.floor(curr_track.currentTime / 60);
                let currentSeconds = Math.floor(
                    curr_track.currentTime - currentMinutes * 60
                );
                let durationMinutes = Math.floor(curr_track.duration / 60);
                let durationSeconds = Math.floor(
                    curr_track.duration - durationMinutes * 60
                );

                // Add a zero to the single digit time values
                if (currentSeconds < 10) {
                    currentSeconds = "0" + currentSeconds;
                }
                if (durationSeconds < 10) {
                    durationSeconds = "0" + durationSeconds;
                }
                if (currentMinutes < 10) {
                    currentMinutes = "0" + currentMinutes;
                }
                if (durationMinutes < 10) {
                    durationMinutes = "0" + durationMinutes;
                }

                // Display the updated duration
                curr_time.textContent = currentMinutes + ":" + currentSeconds;
                total_duration.textContent =
                    durationMinutes + ":" + durationSeconds;
            }
        }
        function playpauseTrack() {
            if (!isPlaying) playTrack();
            else pauseTrack();
        }
        function playTrack() {
            curr_track.play();
            isPlaying = true;
            playpause_btn.innerHTML =
                '<img src="../../assets/img/pause-circle.svg" class="play-ic" style="width: 60.68px; height: 60.929px;"/>';
        }
        function pauseTrack() {
            curr_track.pause();
            isPlaying = false;
            playpause_btn.innerHTML =
                '<img src="../../assets/img/play-circle.svg" class="play-ic" style="width: 60.68px; height: 60.929px;"/>';
        }
        function nextTrack() {
            // Go back to the first track if the
            // current one is the last in the track list
            if (track_index < track_list.length - 1) track_index += 1;
            else track_index = 0;

            // Load and play the new track
            loadTrack(track_index);
            playTrack();
        }

        function prevTrack() {
            // Go back to the last track if the
            // current one is the first in the track list
            if (track_index > 0) track_index -= 1;
            else track_index = track_list.length - 1;

            // Load and play the new track
            loadTrack(track_index);
            playTrack();
        }
        getAllSongs(function (tracks) {
            // Callback function to handle the track_list
            loadTrack(track_index); // Now you can call loadTrack after getting the songs
        });
    </script>
</html>
